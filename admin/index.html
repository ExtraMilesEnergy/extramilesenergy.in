<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Extra Miles Energy</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Admin CSS -->
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <h1 class="login-title">Extra Miles Energy</h1>
            <p style="color: var(--gold-light);">Admin Panel</p>
            <div id="loginMessage" class="message"></div>
            
            <div id="telegramLoginSection">
                <div class="telegram-badge">
                    <p><i class="fab fa-telegram"></i> Login with Telegram</p>
                    <p class="success-text"><i class="fas fa-check-circle"></i> Bot Connected</p>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Enter OTP</label>
                    <div class="otp-input-group">
                        <input type="text" id="otpInput" class="form-input" placeholder="6-digit OTP" maxlength="6">
                        <button class="btn btn-info" onclick="sendOTP()" id="sendOtpBtn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <small>OTP will be sent to your Telegram</small>
                </div>
                
                <div id="otpTimer" class="otp-timer"></div>
                
                <button class="btn btn-success btn-block" onclick="verifyOTP()" id="verifyOtpBtn">
                    <i class="fas fa-check-circle"></i> Verify & Login
                </button>
            </div>
            
            <div class="security-badge">
                <p><i class="fab fa-telegram"></i> Secure 2‑Factor Authentication</p>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" style="display:none;">
        <div class="admin-header">
            <div class="container">
                <div class="header-content">
                    <div>
                        <h2 class="gradient-text">Extra Miles Energy</h2>
                        <div class="company-subtitle">LiFePO₄ Battery & Solar Inverter Solutions</div>
                        <div class="company-badge">Admin Panel (Secure)</div>
                    </div>
                    <button class="btn btn-danger" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Navigation -->
            <div class="admin-nav">
                <button class="nav-btn active" onclick="showTab('dashboard')">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-btn" onclick="showTab('products')">
                    <i class="fas fa-box"></i> Products
                </button>
                <button class="nav-btn" onclick="showTab('addProduct')">
                    <i class="fas fa-plus-circle"></i> Add Product
                </button>
                <button class="nav-btn" onclick="showTab('company')">
                    <i class="fas fa-building"></i> Company
                </button>
                <button class="nav-btn" onclick="showTab('githubSync')">
                    <i class="fab fa-github"></i> GitHub Sync
                </button>
                <button class="nav-btn" onclick="showTab('settings')">
                    <i class="fas fa-cog"></i> Settings
                </button>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="form-container">
                    <h3>Dashboard Overview</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="number" id="totalProducts">0</div>
                            <div class="label">Total Products</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="activeProducts">0</div>
                            <div class="label">Active Products</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="draftProducts">0</div>
                            <div class="label">Draft Products</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="pagesGenerated">0</div>
                            <div class="label">Pages Generated</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="lastSync">--</div>
                            <div class="label">Last Sync</div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="recent-activity">
                        <h4>Recent Activity</h4>
                        <div id="recentActivity">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Products Tab -->
            <div id="products" class="tab-content">
                <div class="form-container">
                    <h3>All Products</h3>
                    <div id="productsList" class="products-grid"></div>
                </div>
            </div>

            <!-- Add Product Tab -->
            <div id="addProduct" class="tab-content">
                <div class="form-container">
                    <h3>Add New Product</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Product Name</label>
                        <input type="text" id="productName" class="form-input" placeholder="Enter product name">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Price (₹)</label>
                            <input type="number" id="productPrice" class="form-input" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select id="productCategory" class="form-input">
                                <option value="">Select category</option>
                                <option value="battery">Battery</option>
                                <option value="inverter">Inverter</option>
                                <option value="solar">Solar Panel</option>
                                <option value="accessory">Accessory</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea id="productDescription" class="form-input" rows="3" placeholder="Product description"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Specifications</label>
                        <textarea id="productSpecs" class="form-input" rows="4" placeholder="Technical specifications"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Product Images</label>
                        
                        <!-- Image Upload Area -->
                        <div class="file-upload-area" onclick="triggerFileUpload()">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>Click to upload images or drag and drop</p>
                            <small>PNG, JPG, GIF up to 10MB</small>
                            <input type="file" id="imageUpload" multiple accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                        </div>

                        <!-- Camera Options -->
                        <div class="camera-options">
                            <button class="camera-btn" onclick="openCamera()">
                                <i class="fas fa-camera"></i> Take Photo
                            </button>
                        </div>

                        <!-- Image Preview Grid -->
                        <div id="productImagesPreview" class="images-grid"></div>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-success" onclick="saveProduct()">
                            <i class="fas fa-save"></i> Save Product
                        </button>
                        <button class="btn btn-info" onclick="resetProductForm()">
                            <i class="fas fa-undo"></i> Reset
                        </button>
                    </div>
                </div>
            </div>

            <!-- Company Tab -->
            <div id="company" class="tab-content">
                <div class="form-container">
                    <h3>Company Details</h3>
                    <div id="companyDetails"></div>
                </div>
            </div>

            <!-- GitHub Sync Tab -->
            <div id="githubSync" class="tab-content">
                <div class="sync-panel">
                    <div class="sync-header">
                        <i class="fab fa-github"></i>
                        <div>
                            <h3>GitHub Sync Status</h3>
                            <div id="githubStatus">Not configured</div>
                        </div>
                        <span class="sync-badge" id="syncStatusBadge">Offline</span>
                    </div>

                    <div class="sync-options">
                        <div class="sync-card">
                            <h4><i class="fas fa-box"></i> Products</h4>
                            <p>Sync all products to GitHub</p>
                            <button class="btn btn-info" onclick="syncProductsToGitHub()">
                                <i class="fas fa-sync-alt"></i> Sync Products
                            </button>
                            <button class="btn btn-purple" onclick="fetchProductsFromGitHub()">
                                <i class="fas fa-download"></i> Fetch from GitHub
                            </button>
                            <div class="progress-bar" id="productSyncProgress">
                                <div class="progress-fill" id="productSyncFill"></div>
                            </div>
                        </div>

                        <div class="sync-card">
                            <h4><i class="fas fa-building"></i> Company Details</h4>
                            <p>Sync company information</p>
                            <button class="btn btn-info" onclick="syncCompanyToGitHub()">
                                <i class="fas fa-sync-alt"></i> Sync Company
                            </button>
                            <button class="btn btn-purple" onclick="fetchCompanyFromGitHub()">
                                <i class="fas fa-download"></i> Fetch from GitHub
                            </button>
                            <div class="progress-bar" id="companySyncProgress">
                                <div class="progress-fill" id="companySyncFill"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab - GitHub Sync Configuration -->
<div id="settings" class="tab-content">
    <div class="form-container">
        <h3 style="color: var(--gold); margin-bottom: 20px;">⚙️ GitHub Sync Settings</h3>
        
        <div style="background: rgba(53,208,255,0.1); border: 1px solid var(--accent); border-radius: var(--radius); padding: 20px; margin-bottom: 30px;">
            <h4 style="color: var(--accent); margin-bottom: 15px;"><i class="fab fa-github"></i> GitHub Configuration</h4>
            <p style="color: var(--text-muted); margin-bottom: 20px;">Configure your GitHub repository settings for automatic sync.</p>
            
            <div class="form-group">
                <label class="form-label">GitHub Username</label>
                <input type="text" id="settings_github_username" class="form-input" placeholder="e.g., ExtraMilesEnergy" value="ExtraMilesEnergy">
            </div>
            
            <div class="form-group">
                <label class="form-label">Repository Name</label>
                <input type="text" id="settings_github_repo" class="form-input" placeholder="e.g., extramilesenergy.in" value="extramilesenergy.in">
            </div>
            
            <div class="form-group">
                <label class="form-label">Branch</label>
                <input type="text" id="settings_github_branch" class="form-input" placeholder="e.g., main" value="main">
            </div>
            
            <div class="form-group">
                <label class="form-label">Products JSON Path</label>
                <input type="text" id="settings_products_path" class="form-input" placeholder="e.g., all-products.json" value="all-products.json">
                <small style="color: var(--text-muted);">Path to your products JSON file in the repository</small>
            </div>
            
            <div class="form-group">
                <label class="form-label">GitHub Token <span style="color: var(--danger);">(Secret - Not Saved)</span></label>
                <input type="password" id="settings_github_token" class="form-input" placeholder="Enter your GitHub Personal Access Token">
                <small style="color: var(--warning);"><i class="fas fa-exclamation-triangle"></i> Token is never saved in browser. You need to enter it each session.</small>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="btn btn-success" onclick="testGitHubConnection()">
                    <i class="fas fa-plug"></i> Test Connection
                </button>
                <button class="btn btn-info" onclick="saveGitHubSettings()">
                    <i class="fas fa-save"></i> Save Settings
                </button>
            </div>
        </div>
        
        <div style="background: rgba(69,255,144,0.1); border: 1px solid var(--success); border-radius: var(--radius); padding: 20px; margin-bottom: 30px;">
            <h4 style="color: var(--success); margin-bottom: 15px;"><i class="fas fa-sync-alt"></i> Sync Options</h4>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: var(--radius-sm);">
                    <i class="fas fa-box" style="font-size: 2rem; color: var(--gold); margin-bottom: 10px;"></i>
                    <h5 style="color: var(--gold);">Products</h5>
                    <p style="color: var(--text-muted); font-size: 0.9rem;">Sync all products with GitHub</p>
                    <button class="btn btn-info" onclick="syncProductsToGitHub()" style="width: 100%; margin-top: 10px;">
                        <i class="fas fa-sync-alt"></i> Sync Now
                    </button>
                </div>
                
                <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: var(--radius-sm);">
                    <i class="fas fa-building" style="font-size: 2rem; color: var(--gold); margin-bottom: 10px;"></i>
                    <h5 style="color: var(--gold);">Company</h5>
                    <p style="color: var(--text-muted); font-size: 0.9rem;">Sync company details with GitHub</p>
                    <button class="btn btn-info" onclick="syncCompanyToGitHub()" style="width: 100%; margin-top: 10px;">
                        <i class="fas fa-sync-alt"></i> Sync Now
                    </button>
                </div>
                
                <div style="text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: var(--radius-sm);">
                    <i class="fas fa-images" style="font-size: 2rem; color: var(--gold); margin-bottom: 10px;"></i>
                    <h5 style="color: var(--gold);">Images</h5>
                    <p style="color: var(--text-muted); font-size: 0.9rem;">Sync all product images</p>
                    <button class="btn btn-info" onclick="syncImagesToGitHub()" style="width: 100%; margin-top: 10px;">
                        <i class="fas fa-sync-alt"></i> Sync Now
                    </button>
                </div>
            </div>
        </div>
        
        <div style="background: rgba(255,53,112,0.1); border: 1px solid var(--danger); border-radius: var(--radius); padding: 20px;">
            <h4 style="color: var(--danger); margin-bottom: 15px;"><i class="fas fa-exclamation-triangle"></i> Danger Zone</h4>
            
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                <div>
                    <h5 style="color: var(--text);">Reset All Settings</h5>
                    <p style="color: var(--text-muted); font-size: 0.9rem;">Clear all saved settings and reset to defaults</p>
                </div>
                <button class="btn btn-danger" onclick="resetGitHubSettings()">
                    <i class="fas fa-undo"></i> Reset Settings
                </button>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-top: 20px;">
                <div>
                    <h5 style="color: var(--text);">Clear GitHub Token</h5>
                    <p style="color: var(--text-muted); font-size: 0.9rem;">Remove token from current session</p>
                </div>
                <button class="btn btn-warning" onclick="clearGitHubToken()">
                    <i class="fas fa-times"></i> Clear Token
                </button>
            </div>
        </div>
        
        <!-- Connection Status -->
        <div id="githubConnectionStatus" style="margin-top: 20px; display: none;"></div>
    </div>
</div>
        </div>
    </div>

    <!-- Camera Modal -->
    <div id="cameraModal" class="camera-modal">
        <div class="camera-container">
            <h3>Take Product Photo</h3>
            <video id="cameraPreview" class="camera-preview" autoplay playsinline></video>
            <div class="camera-controls">
                <button class="btn btn-danger" onclick="closeCamera()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-warning" onclick="switchCamera()">
                    <i class="fas fa-sync-alt"></i> Switch
                </button>
                <button class="btn btn-success" onclick="capturePhoto()">
                    <i class="fas fa-camera"></i> Capture
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Global API_BASE
        const API_BASE = 'https://milly-sheiklike-radically.ngrok-free.dev';
    </script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin-main.js"></script>
</body>
</html>
