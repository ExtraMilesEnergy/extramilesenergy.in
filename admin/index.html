<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Extra Miles Energy - Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-50">

<div class="max-w-7xl mx-auto p-6">
  
  <!-- Header with Business Info -->
  <div class="bg-gradient-to-r from-blue-800 to-indigo-800 text-white p-6 rounded-2xl shadow-lg mb-6">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
      <div>
        <h1 class="text-3xl font-bold flex items-center gap-2">
          ‚ö° Extra Miles Energy
          <span class="bg-yellow-400 text-blue-900 text-sm px-3 py-1 rounded-full">PRODUCTION</span>
        </h1>
        <p class="text-blue-200 mt-1">Skyline Stores ‚Ä¢ Lithium Battery, Solar Inverter & EV Products</p>
      </div>
      <div class="mt-3 md:mt-0 text-sm bg-white/10 p-3 rounded-xl">
        <p><i class="fas fa-map-marker-alt mr-2"></i>Shop No-8, Opp The Aryan School, Kaimri Road, Hisar - 125001</p>
        <p class="mt-1"><i class="fas fa-phone mr-2"></i>+91-9991144903 | <i class="fab fa-whatsapp mr-2"></i>+91-7876555055</p>
        <p class="mt-1"><i class="fas fa-id-card mr-2"></i>GST: 06AUIPP2101K2ZR</p>
      </div>
    </div>
  </div>

  <!-- GitHub Configuration -->
  <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
    <h2 class="text-2xl font-bold mb-6 flex items-center">
      <i class="fab fa-github text-3xl mr-3"></i>
      GitHub Configuration
    </h2>
    
    <div class="grid md:grid-cols-3 gap-6 mb-6">
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">GitHub Token *</label>
        <input type="password" id="githubToken" class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200" placeholder="ghp_xxxxxxxxxxxx">
        <p class="text-xs text-gray-500 mt-2">Required for upload</p>
      </div>
      
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Repository</label>
        <input type="text" id="githubRepo" class="w-full border-2 border-gray-200 p-3 rounded-xl bg-gray-100" value="ExtraMilesEnergy/extramilesenergy.in" readonly>
        <p class="text-xs text-green-600 mt-2"><i class="fas fa-check-circle"></i> Correct repository</p>
      </div>
      
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Branch</label>
        <input type="text" id="githubBranch" class="w-full border-2 border-gray-200 p-3 rounded-xl" value="main">
      </div>
    </div>

    <button onclick="testGitHubConnection()" class="bg-blue-600 text-white px-8 py-3 rounded-xl hover:bg-blue-700 transition font-semibold">
      <i class="fas fa-plug mr-2"></i>Test Connection
    </button>

    <div id="connectionStatus" class="mt-4 p-4 rounded-xl hidden"></div>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
    <div class="bg-white p-6 rounded-xl shadow-lg">
      <p class="text-gray-500 text-sm">Total Products</p>
      <p class="text-3xl font-bold" id="totalProducts">0</p>
    </div>
    <div class="bg-white p-6 rounded-xl shadow-lg">
      <p class="text-gray-500 text-sm">On GitHub</p>
      <p class="text-3xl font-bold" id="githubCount">0</p>
    </div>
    <div class="bg-white p-6 rounded-xl shadow-lg">
      <p class="text-gray-500 text-sm">Categories</p>
      <p class="text-3xl font-bold">5</p>
    </div>
    <div class="bg-white p-6 rounded-xl shadow-lg">
      <p class="text-gray-500 text-sm">Images</p>
      <p class="text-3xl font-bold" id="totalImages">0</p>
    </div>
    <div class="bg-white p-6 rounded-xl shadow-lg">
      <p class="text-gray-500 text-sm">Featured</p>
      <p class="text-3xl font-bold" id="featuredCount">0</p>
    </div>
  </div>

  <!-- Add Product Form -->
  <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
    <h2 class="text-2xl font-bold mb-6 flex items-center">
      <i class="fas fa-plus-circle text-green-600 mr-3"></i>
      Add New Product (Auto Upload to GitHub)
    </h2>
    
    <div class="grid md:grid-cols-2 gap-8">
      <!-- Left Column -->
      <div>
        <div class="mb-5">
          <label class="block font-semibold text-gray-700 mb-2">Product Name *</label>
          <input type="text" id="productName" class="w-full border-2 border-gray-200 p-3 rounded-xl focus:border-blue-500" placeholder="e.g., Lithium Battery 48V">
        </div>
        
        <div class="mb-5">
          <label class="block font-semibold text-gray-700 mb-2">Category *</label>
          <select id="productCategory" class="w-full border-2 border-gray-200 p-3 rounded-xl">
            <option value="EV Battery">üöó EV Battery</option>
            <option value="Solar ESS Battery">‚òÄÔ∏è Solar ESS Battery</option>
            <option value="Solar Inverter">üîã Solar Inverter</option>
            <option value="EV Charger">‚ö° EV Charger</option>
            <option value="Accessories">üîß Accessories</option>
          </select>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-5">
          <div>
            <label class="block font-semibold text-gray-700 mb-2">Price (‚Çπ) *</label>
            <input type="number" id="productPrice" class="w-full border-2 border-gray-200 p-3 rounded-xl" value="0">
          </div>
          <div>
            <label class="block font-semibold text-gray-700 mb-2">Stock</label>
            <input type="number" id="productStock" class="w-full border-2 border-gray-200 p-3 rounded-xl" value="10">
          </div>
        </div>

        <div class="mb-5">
          <label class="flex items-center">
            <input type="checkbox" id="productFeatured" class="w-5 h-5 mr-3">
            <span class="font-semibold text-gray-700">Mark as Featured Product</span>
          </label>
        </div>
      </div>

      <!-- Right Column -->
      <div>
        <div class="mb-5">
          <label class="block font-semibold text-gray-700 mb-2">Images * (Max 5, 5MB each)</label>
          <input type="file" id="productImages" multiple accept="image/*" class="w-full border-2 border-gray-200 p-2 rounded-xl">
          <div id="imagePreview" class="grid grid-cols-5 gap-2 mt-3"></div>
        </div>

        <div class="mb-5">
          <label class="block font-semibold text-gray-700 mb-2">Description *</label>
          <textarea id="productDesc" rows="4" class="w-full border-2 border-gray-200 p-3 rounded-xl" placeholder="Detailed product description..."></textarea>
        </div>

        <div class="mb-5">
          <label class="block font-semibold text-gray-700 mb-2">Key Features (one per line)</label>
          <textarea id="productFeatures" rows="3" class="w-full border-2 border-gray-200 p-3 rounded-xl" placeholder="Long cycle life&#10;Fast charging&#10;IP65 waterproof"></textarea>
        </div>
      </div>
    </div>

    <button onclick="uploadToGitHub()" class="w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-4 rounded-xl font-bold text-lg hover:from-green-700 hover:to-green-800 transition transform hover:scale-[1.02] mt-4">
      <i class="fab fa-github mr-2 text-2xl"></i>
      SAVE TO GITHUB REPOSITORY
    </button>
  </div>

  <!-- Product List -->
  <div class="bg-white rounded-2xl shadow-xl p-6">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold">üì¶ Products in Repository</h2>
      <div class="flex gap-3">
        <input type="text" id="searchInput" placeholder="Search products..." class="border-2 border-gray-200 p-2 rounded-xl w-64">
        <select id="filterCategory" class="border-2 border-gray-200 p-2 rounded-xl">
          <option value="">All Categories</option>
          <option value="EV Battery">EV Battery</option>
          <option value="Solar ESS Battery">Solar ESS Battery</option>
          <option value="Solar Inverter">Solar Inverter</option>
          <option value="EV Charger">EV Charger</option>
          <option value="Accessories">Accessories</option>
        </select>
      </div>
    </div>
    
    <div id="productList" class="space-y-4">
      <!-- Products will appear here -->
    </div>
  </div>
</div>

<!-- Loader -->
<div id="loader" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
  <div class="bg-white p-8 rounded-2xl text-center max-w-md">
    <div class="animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent mx-auto mb-4"></div>
    <p class="text-xl font-bold text-gray-800" id="loaderText">Uploading to GitHub...</p>
    <p class="text-gray-600 mt-2" id="loaderSubtext">Please don't close this window</p>
    <div class="mt-4 h-2 bg-gray-200 rounded-full overflow-hidden">
      <div id="progressBar" class="h-full bg-blue-600" style="width: 0%"></div>
    </div>
  </div>
</div>

<script>
// ==================== STATE ====================
let products = [];
let imageFiles = [];

// ==================== LOADER FUNCTIONS ====================
function showLoader(message, subtext) {
  document.getElementById('loaderText').textContent = message || 'Uploading to GitHub...';
  document.getElementById('loaderSubtext').textContent = subtext || 'Please wait';
  document.getElementById('loader').classList.remove('hidden');
  document.getElementById('loader').classList.add('flex');
}

function updateProgress(percent) {
  document.getElementById('progressBar').style.width = percent + '%';
}

function hideLoader() {
  document.getElementById('loader').classList.add('hidden');
  document.getElementById('loader').classList.remove('flex');
  document.getElementById('progressBar').style.width = '0%';
}

// ==================== TOAST MESSAGES ====================
function showToast(message, type = 'success') {
  Swal.fire({
    icon: type,
    title: type === 'success' ? 'Success' : 'Error',
    text: message,
    timer: 3000,
    showConfirmButton: false
  });
}

// ==================== FILE TO BASE64 ====================
function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => {
      const base64 = reader.result.split(',')[1];
      resolve(base64);
    };
    reader.onerror = error => reject(error);
  });
}

// ==================== TEST GITHUB CONNECTION ====================
async function testGitHubConnection() {
  const token = document.getElementById('githubToken').value;
  const repo = document.getElementById('githubRepo').value;
  
  if (!token) {
    Swal.fire('Error', 'Please enter GitHub token', 'error');
    return;
  }

  showLoader('Testing Connection...', 'Checking GitHub API access');
  
  try {
    const response = await fetch(`https://api.github.com/repos/${repo}`, {
      headers: {
        'Authorization': `token ${token}`,
        'Accept': 'application/vnd.github.v3+json'
      }
    });

    if (response.ok) {
      const data = await response.json();
      hideLoader();
      
      const statusDiv = document.getElementById('connectionStatus');
      statusDiv.classList.remove('hidden', 'bg-red-50', 'text-red-700');
      statusDiv.classList.add('bg-green-50', 'text-green-700');
      statusDiv.innerHTML = `
        <i class="fas fa-check-circle mr-2 text-green-600"></i>
        <strong>Connected!</strong> Repository: ${data.full_name} (${data.private ? 'Private' : 'Public'})
        <br><small>Default branch: ${data.default_branch}</small>
      `;
      
      Swal.fire('Success', 'GitHub connection successful!', 'success');
    } else {
      hideLoader();
      throw new Error('Invalid token or repository');
    }
  } catch (error) {
    hideLoader();
    
    document.getElementById('connectionStatus').classList.remove('hidden', 'bg-green-50', 'text-green-700');
    document.getElementById('connectionStatus').classList.add('bg-red-50', 'text-red-700');
    document.getElementById('connectionStatus').innerHTML = `
      <i class="fas fa-exclamation-circle mr-2 text-red-600"></i>
      Connection failed: ${error.message}
    `;
    
    Swal.fire('Error', 'Connection failed: ' + error.message, 'error');
  }
}

// ==================== GITHUB UPLOAD ====================
async function githubUpload(path, content, message) {
  const token = document.getElementById('githubToken').value;
  const repo = document.getElementById('githubRepo').value;
  const branch = document.getElementById('githubBranch').value;

  if (!token) {
    throw new Error('GitHub token is required');
  }

  const url = `https://api.github.com/repos/${repo}/contents/${path}`;
  
  // Check if file exists
  let sha = null;
  try {
    const response = await fetch(url, {
      headers: {
        'Authorization': `token ${token}`,
        'Accept': 'application/vnd.github.v3+json'
      }
    });
    if (response.ok) {
      const data = await response.json();
      sha = data.sha;
    }
  } catch (e) {
    // File doesn't exist
  }

  // Upload file
  const response = await fetch(url, {
    method: 'PUT',
    headers: {
      'Authorization': `token ${token}`,
      'Content-Type': 'application/json',
      'Accept': 'application/vnd.github.v3+json'
    },
    body: JSON.stringify({
      message: message || `Add ${path}`,
      content: content,
      branch: branch,
      sha: sha
    })
  });

  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.message || 'Upload failed');
  }

  return await response.json();
}

// ==================== UPLOAD TO GITHUB ====================
async function uploadToGitHub() {
  try {
    // Get form values
    const name = document.getElementById('productName').value.trim();
    const category = document.getElementById('productCategory').value;
    const price = document.getElementById('productPrice').value;
    const stock = document.getElementById('productStock').value;
    const featured = document.getElementById('productFeatured').checked;
    const desc = document.getElementById('productDesc').value.trim();
    const features = document.getElementById('productFeatures').value.trim();
    const imageInput = document.getElementById('productImages');
    
    // Validate
    if (!name) {
      Swal.fire('Error', 'Please enter product name', 'error');
      return;
    }
    
    if (!category) {
      Swal.fire('Error', 'Please select category', 'error');
      return;
    }
    
    if (!price || price <= 0) {
      Swal.fire('Error', 'Please enter valid price', 'error');
      return;
    }
    
    if (imageInput.files.length === 0) {
      Swal.fire('Error', 'Please select at least one image', 'error');
      return;
    }
    
    if (!desc) {
      Swal.fire('Error', 'Please enter description', 'error');
      return;
    }

    const token = document.getElementById('githubToken').value;
    if (!token) {
      Swal.fire('Error', 'Please enter GitHub token', 'error');
      return;
    }

    showLoader('Uploading to GitHub...', 'This may take a few moments');
    updateProgress(10);

    // Create slug
    const slug = name.toLowerCase()
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/(^-|-$)/g, '');

    const repo = document.getElementById('githubRepo').value;
    const username = repo.split('/')[0];
    const repoName = repo.split('/')[1];
    const imageUrls = [];

    // Upload images
    for (let i = 0; i < imageInput.files.length; i++) {
      const file = imageInput.files[i];
      updateProgress(20 + (i * 10));
      
      const base64 = await fileToBase64(file);
      const ext = file.name.split('.').pop() || 'jpg';
      const imagePath = `products/images/${slug}-${i+1}.${ext}`;
      
      await githubUpload(imagePath, base64, `Add image ${i+1} for ${name}`);
      
      const imageUrl = `https://raw.githubusercontent.com/${repo}/main/${imagePath}`;
      imageUrls.push(imageUrl);
    }

    updateProgress(60);

    // Generate product HTML
    const productHTML = generateProductHTML({
      name, category, price, stock, featured, desc, features,
      images: imageUrls, slug
    });

    // Upload HTML
    const htmlBase64 = btoa(unescape(encodeURIComponent(productHTML)));
    await githubUpload(`products/${slug}.html`, htmlBase64, `Add product: ${name}`);

    updateProgress(90);

    // Create product object
    const product = {
      id: Date.now(),
      name,
      category,
      price,
      stock,
      featured,
      desc,
      features,
      slug,
      images: imageUrls,
      githubPath: `products/${slug}.html`,
      liveUrl: `https://${username}.github.io/${repoName}/products/${slug}.html`,
      githubUrl: `https://github.com/${repo}/blob/main/products/${slug}.html`,
      uploadedAt: new Date().toISOString()
    };

    // Save to local storage
    products.unshift(product);
    localStorage.setItem('github_products', JSON.stringify(products));

    updateProgress(100);
    hideLoader();

    // Show success
    Swal.fire({
      icon: 'success',
      title: 'Uploaded to GitHub!',
      html: `
        <div class="text-left">
          <p class="mb-2"><i class="fas fa-check-circle text-green-500 mr-2"></i>${imageUrls.length} images uploaded</p>
          <p class="mb-2"><i class="fas fa-check-circle text-green-500 mr-2"></i>Product page created</p>
          <p class="mt-4"><strong>Live URL:</strong><br>
          <a href="${product.liveUrl}" target="_blank" class="text-blue-600 break-all">${product.liveUrl}</a></p>
          <p class="mt-2"><strong>GitHub URL:</strong><br>
          <a href="${product.githubUrl}" target="_blank" class="text-blue-600 break-all">${product.githubUrl}</a></p>
        </div>
      `,
      confirmButtonText: 'View Product',
      showCancelButton: true,
      cancelButtonText: 'Add Another'
    }).then((result) => {
      if (result.isConfirmed) {
        window.open(product.liveUrl, '_blank');
      } else {
        resetForm();
      }
    });

    renderProducts();
    updateStats();

  } catch (error) {
    hideLoader();
    console.error('Upload error:', error);
    Swal.fire('Error', 'Upload failed: ' + error.message, 'error');
  }
}

// ==================== GENERATE PRODUCT HTML ====================
function generateProductHTML(p) {
  const images = p.images.map(img => 
    `<img src="${img}" class="w-full rounded-xl mb-4 shadow-lg" alt="${p.name}">`
  ).join('');

  const features = p.features ? 
    `<div class="mt-6">
      <h3 class="font-bold text-lg mb-3">‚ú® Key Features</h3>
      <ul class="list-disc pl-5 space-y-2">
        ${p.features.split('\n').map(f => `<li>${f}</li>`).join('')}
      </ul>
    </div>` : '';

  return `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${p.name} | Extra Miles Energy</title>
  <meta name="description" content="${p.desc.substring(0, 160)}">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">
  <div class="max-w-6xl mx-auto p-6">
    <!-- Breadcrumb -->
    <nav class="text-sm mb-6">
      <a href="/" class="text-blue-600 hover:underline">Home</a> &gt;
      <a href="/products" class="text-blue-600 hover:underline">Products</a> &gt;
      <span class="text-gray-600">${p.name}</span>
    </nav>

    <!-- Product -->
    <div class="bg-white rounded-2xl shadow-xl p-8">
      <div class="grid md:grid-cols-2 gap-8">
        <div class="space-y-4">
          ${images}
        </div>
        <div>
          <h1 class="text-3xl font-bold mb-3">${p.name}</h1>
          <p class="text-gray-600 mb-4">${p.category}</p>
          <p class="text-3xl font-bold text-blue-600 mb-4">‚Çπ${p.price}</p>
          ${p.featured ? '<span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm">‚≠ê Featured</span>' : ''}
          <p class="text-gray-700 mt-4">${p.desc}</p>
          ${features}
          
          <!-- Actions -->
          <div class="mt-8 flex gap-4">
            <a href="https://wa.me/917876555055?text=I'm%20interested%20in%20${encodeURIComponent(p.name)}" 
               class="flex-1 bg-green-600 text-white py-4 rounded-xl font-semibold text-center hover:bg-green-700">
              <i class="fab fa-whatsapp mr-2"></i>WhatsApp
            </a>
            <a href="tel:+919991144903" 
               class="flex-1 bg-blue-600 text-white py-4 rounded-xl font-semibold text-center hover:bg-blue-700">
              <i class="fas fa-phone mr-2"></i>Call Now
            </a>
          </div>
          
          <!-- Business Info -->
          <div class="mt-6 p-4 bg-gray-50 rounded-xl text-sm">
            <p><i class="fas fa-store mr-2"></i>Skyline Stores</p>
            <p class="mt-1"><i class="fas fa-map-marker-alt mr-2"></i>Shop No-8, Opp The Aryan School, Kaimri Road, Hisar - 125001</p>
            <p class="mt-1"><i class="fas fa-id-card mr-2"></i>GST: 06AUIPP2101K2ZR</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>`;
}

// ==================== RESET FORM ====================
function resetForm() {
  document.getElementById('productName').value = '';
  document.getElementById('productCategory').value = 'EV Battery';
  document.getElementById('productPrice').value = '0';
  document.getElementById('productStock').value = '10';
  document.getElementById('productFeatured').checked = false;
  document.getElementById('productDesc').value = '';
  document.getElementById('productFeatures').value = '';
  document.getElementById('productImages').value = '';
  document.getElementById('imagePreview').innerHTML = '';
}

// ==================== RENDER PRODUCTS ====================
function renderProducts() {
  const list = document.getElementById('productList');
  
  if (products.length === 0) {
    list.innerHTML = '<div class="text-center py-12 text-gray-500">No products in repository yet</div>';
    return;
  }
  
  list.innerHTML = products.map(p => `
    <div class="border rounded-xl p-4 hover:shadow-lg transition">
      <div class="flex justify-between items-start">
        <div>
          <h3 class="font-bold text-lg">${p.name}</h3>
          <p class="text-sm text-gray-600">${p.category} ‚Ä¢ ‚Çπ${p.price} ‚Ä¢ Stock: ${p.stock}</p>
        </div>
        <div class="flex gap-2">
          <a href="${p.liveUrl}" target="_blank" class="text-green-600 hover:text-green-800">
            <i class="fas fa-external-link-alt"></i> Live
          </a>
          <a href="${p.githubUrl}" target="_blank" class="text-blue-600 hover:text-blue-800 ml-3">
            <i class="fab fa-github"></i> GitHub
          </a>
        </div>
      </div>
    </div>
  `).join('');
}

// ==================== UPDATE STATS ====================
function updateStats() {
  document.getElementById('totalProducts').textContent = products.length;
  document.getElementById('githubCount').textContent = products.length;
  
  const totalImages = products.reduce((sum, p) => sum + (p.images?.length || 0), 0);
  document.getElementById('totalImages').textContent = totalImages;
  
  const featured = products.filter(p => p.featured).length;
  document.getElementById('featuredCount').textContent = featured;
}

// ==================== IMAGE PREVIEW ====================
document.getElementById('productImages').addEventListener('change', function(e) {
  const preview = document.getElementById('imagePreview');
  preview.innerHTML = '';
  
  for (let i = 0; i < e.target.files.length; i++) {
    const file = e.target.files[i];
    const reader = new FileReader();
    
    reader.onload = function(e) {
      const div = document.createElement('div');
      div.className = 'relative';
      div.innerHTML = `
        <img src="${e.target.result}" class="w-full h-16 object-cover rounded-lg border-2 border-blue-200">
        <span class="absolute -top-2 -right-2 bg-green-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">‚úì</span>
      `;
      preview.appendChild(div);
    };
    
    reader.readAsDataURL(file);
  }
});

// ==================== SEARCH AND FILTER ====================
document.getElementById('searchInput').addEventListener('keyup', function() {
  const search = this.value.toLowerCase();
  const filtered = products.filter(p => 
    p.name.toLowerCase().includes(search) || 
    p.desc.toLowerCase().includes(search)
  );
  
  if (filtered.length === 0) {
    document.getElementById('productList').innerHTML = '<div class="text-center py-8 text-gray-500">No products found</div>';
  } else {
    renderFilteredProducts(filtered);
  }
});

function renderFilteredProducts(filtered) {
  const list = document.getElementById('productList');
  list.innerHTML = filtered.map(p => `
    <div class="border rounded-xl p-4 hover:shadow-lg transition">
      <div class="flex justify-between items-start">
        <div>
          <h3 class="font-bold text-lg">${p.name}</h3>
          <p class="text-sm text-gray-600">${p.category} ‚Ä¢ ‚Çπ${p.price}</p>
        </div>
        <a href="${p.liveUrl}" target="_blank" class="text-blue-600 hover:text-blue-800">
          <i class="fas fa-external-link-alt mr-1"></i>View
        </a>
      </div>
    </div>
  `).join('');
}

// ==================== INIT ====================
window.onload = function() {
  // Load products from localStorage
  const saved = localStorage.getItem('github_products');
  if (saved) {
    products = JSON.parse(saved);
    renderProducts();
    updateStats();
  }
  
  // Load saved GitHub token
  const savedToken = localStorage.getItem('github_token');
  if (savedToken) {
    document.getElementById('githubToken').value = savedToken;
  }
  
  // Save token when changed
  document.getElementById('githubToken').addEventListener('change', function() {
    localStorage.setItem('github_token', this.value);
  });
};
</script>

</body>
</html>
